{% extends 'base.html' %}

{% block title %}Installer Dashboard - AutoReminder{% endblock %}

{% block content %}
<div class="min-h-screen bg-[#171717] text-gray-400 p-8">
    {% load custom_filters %}
{% if messages %}
        <div class="space-y-2 mb-4">
          {% for message in messages %}
            <div class="rounded-lg p-4 text-sm {% if message.tags == 'warning' %}bg-yellow-100 text-yellow-900 border border-yellow-300{% elif message.tags == 'error' %}bg-red-100 text-red-900 border border-red-300{% endif %}">
              {{ message }}
            </div>
          {% endfor %}
        </div>
      {% endif %}

    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
        <div class="bg-[#1f1f1f] p-6 rounded-xl shadow-sm border border-[#2c2c2c]">
            <h3 class="text-sm text-white font-semibold mb-1">Total Tasks</h3>
            <p class="text-3xl font-bold text-white">{{ total_tasks }}</p>
            <p class="text-xs text-green-600 mt-1">+1% Since last month</p>
        </div>

        <div class="bg-[#1f1f1f] p-6 rounded-xl shadow-sm border border-[#2c2c2c]">
            <h3 class="text-sm text-white font-semibold mb-1">In Progress</h3>
            <p class="text-3xl font-bold text-white">{{ in_progress }}</p>
            <p class="text-xs text-blue-600 mt-1">Active Ongoing task execution</p>
        </div>

        <div class="bg-[#1f1f1f] p-6 rounded-xl shadow-sm border border-[#2c2c2c]">
            <h3 class="text-sm text-white font-semibold mb-1">Pending Tasks</h3>
            <p class="text-3xl font-bold text-white">{{ pending }}</p>
            <p class="text-xs text-yellow-600 mt-1">Awaiting action</p>
        </div>

        <div class="bg-[#1f1f1f] p-6 rounded-xl shadow-sm border border-[#2c2c2c]">
            <h3 class="text-sm text-white font-semibold mb-1">Completion Rate</h3>
            <p class="text-3xl font-bold text-white">{{ completion_rate }}%</p>
            <p class="text-xs text-red-600 mt-1">{{ completion_rate }}% Since last update</p>
        </div>
    </div>
    <h2 class="text-xl font-lightbold text-gray-100 mb-6">Installation Job List</h2>
    <div class="overflow-x-auto mt-6">
            <table class="min-w-full text-sm bg-[#1f1f1f] text-white rounded-lg shadow-sm border border-[#2c2c2c]">
                <thead class="bg-[#1f1f1f]">
                    <tr>
                        <th class="px-4 py-3 text-center font-medium rounded-tl-md">Installation ID</th>
                        <th class="px-4 py-3 text-center font-medium">Customer</th>
                        <th class="px-4 py-3 text-center font-medium">Location</th>
                        <th class="px-4 py-3 text-center font-medium">Charger Model</th>
                        <th class="px-4 py-3 text-center font-medium">Status</th>
                    </tr>
                </thead>
                <tbody>
                    {% for installation in installations %}
                    {# Make the entire row clickable #}
                    <tr class="hover:bg-gray-600 transition duration-150 border-t border-[#2c2c2c] cursor-pointer"
                        onclick="window.location.href = '{% url 'installation_detail' installation.installation_id %}';">
                        <td class="px-4 py-3 text-center text-[#c0c0c0]">{{ installation.installation_id }}</td>
                        <td class="px-4 py-3 text-center text-[#c0c0c0]">{{ installation.customer.name }}</td>
                        <td class="px-4 py-3 text-center text-[#c0c0c0]">{{ installation.customer.city }}, {{ installation.customer.state }}</td>
                        <td class="px-4 py-3 text-center text-[#c0c0c0]">{{ installation.charger_model.model_name }}</td>
                        <td class="px-4 py-3 text-center">
                                {% if installation.status == 'COMPLETED' %} {# Updated status values #}
                                <span class="inline-block px-3 py-1 text-xs font-semibold text-green-100 bg-green-600 rounded-full">Completed</span>
                                {% elif installation.status == 'IN_PROGRESS' %} {# Updated status values #}
                                <span class="inline-block px-3 py-1 text-xs font-semibold text-yellow-100 bg-yellow-600 rounded-full">In Progress</span>
                                {% elif installation.status == 'SUBMITTED' %} {# Updated status values #}
                                <span class="inline-block px-3 py-1 text-xs font-semibold text-gray-100 bg-gray-500 rounded-full">Submitted</span>
                                {% elif installation.status == 'PENDING_ACCEPTANCE' %} {# Added new status #}
                                <span class="inline-block px-3 py-1 text-xs font-semibold text-blue-100 bg-blue-600 rounded-full">Pending Acceptance</span>
                                {% elif installation.status == 'ACCEPTED' %} {# Added new status #}
                                <span class="inline-block px-3 py-1 text-xs font-semibold text-purple-100 bg-purple-600 rounded-full">Accepted</span>
                                {% elif installation.status == 'REJECTED' %} {# Added new status #}
                                <span class="inline-block px-3 py-1 text-xs font-semibold text-red-100 bg-red-600 rounded-full">Rejected</span>
                                {% elif installation.status == 'EXPIRED' %} {# Added new status #}
                                <span class="inline-block px-3 py-1 text-xs font-semibold text-red-100 bg-red-800 rounded-full">Expired</span>
                                {% else %}
                                <span class="inline-block px-3 py-1 text-xs font-semibold text-red-100 bg-red-600 rounded-full">{{ installation.get_status_display }}</span> {# Use get_status_display #}
                                {% endif %}
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="5" class="px-4 py-6 text-center text-gray-300">No installations assigned to you.</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
</div>
{% endblock %}
{% extends 'base.html' %}
{% block content %}
<div class="min-h-screen">
    <div class="max-w-8xl mx-auto">
        <h2 class="text-2xl font-semibold text-gray-100 mb-6">Installer List</h2>

        <div class="overflow-x-auto">
            <table class="min-w-full text-xs bg-gray-700 text-white rounded-md shadow-sm">
                <thead class="bg-gray-800">
                    <tr>
                        <th class="px-4 py-3 text-center font-medium rounded-tl-md">#</th>
                        <th class="px-4 py-3 text-center font-medium">PIC Name</th>
                        <th class="px-4 py-3 text-center font-medium">PIC Contact</th>
                        <th class="px-4 py-3 text-center font-medium">PIC Email</th>
                        <th class="px-4 py-3 text-center font-medium">Company</th>
                        <th class="px-4 py-3 text-center font-medium">State</th>
                        <th class="px-4 py-3 text-center font-medium">SSM Number</th>
                        <th class="px-4 py-3 text-center font-medium">EPF Contributors</th>
                        <th class="px-4 py-3 text-center font-medium">ST</th>
                        <th class="px-4 py-3 text-center font-medium">License Class</th>
                        <th class="px-4 py-3 text-center font-medium">CIDB</th>
                        <th class="px-4 py-3 text-center font-medium">CIDB Category</th>
                        <th class="px-4 py-3 text-center font-medium">CIDB Grade</th>
                        <th class="px-4 py-3 text-center font-medium">SST</th>
                        <th class="px-4 py-3 text-center font-medium">SST Number</th>
                        <th class="px-4 py-3 text-center font-medium">Insurance</th>
                        <th class="px-4 py-3 text-center font-medium">COI History</th>
                        <th class="px-4 py-3 text-center font-medium">Date Joined</th>
                        <th class="px-4 py-3 text-center font-medium rounded-tr-md">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for installer in installers %}
                    <tr class="hover:bg-gray-600 transition duration-150 border-t border-gray-600">
                        <td class="px-4 py-3 text-center">{{ forloop.counter }}</td>

                        {% if installer.installerprofile %}
                            <td class="px-4 py-3 text-center">{{ installer.installerprofile.pic_name|default:"-" }}</td>
                            <td class="px-4 py-3 text-center">{{ installer.installerprofile.pic_contact_number|default:"-" }}</td>
                            <td class="px-4 py-3 text-center">{{ installer.installerprofile.pic_email|default:"-" }}</td>
                            <td class="px-4 py-3 text-center">{{ installer.installerprofile.company_name|default:"-" }}</td>
                            <td class="px-4 py-3 text-center">{{ installer.installerprofile.operational_state|default:"-" }}</td>
                            <td class="px-4 py-3 text-center">{{ installer.installerprofile.company_ssm_number|default:"-" }}</td>
                            <td class="px-4 py-3 text-center">{{ installer.installerprofile.epf_contributors|default:"-" }}</td>
                            <td class="px-4 py-3 text-center">{% if installer.installerprofile.is_st_registered %}✅{% else %}❌{% endif %}</td>
                            <td class="px-4 py-3 text-center">{{ installer.installerprofile.contractor_license_class|default:"-" }}</td>
                            <td class="px-4 py-3 text-center">{% if installer.installerprofile.is_cidb_registered %}✅{% else %}❌{% endif %}</td>
                            <td class="px-4 py-3 text-center">{{ installer.installerprofile.cidb_category|default:"-" }}</td>
                            <td class="px-4 py-3 text-center">{{ installer.installerprofile.cidb_grade|default:"-" }}</td>
                            <td class="px-4 py-3 text-center">{% if installer.installerprofile.is_sst_registered %}✅{% else %}❌{% endif %}</td>
                            <td class="px-4 py-3 text-center">{{ installer.installerprofile.sst_number|default:"-" }}</td>
                            <td class="px-4 py-3 text-center">{% if installer.installerprofile.has_insurance %}✅{% else %}❌{% endif %}</td>
                            <td class="px-4 py-3 text-center">{% if installer.installerprofile.has_coi_history %}✅{% else %}❌{% endif %}</td>
                            <td class="px-4 py-3 text-center">{{ installer.date_joined|date:"Y-m-d H:i" }}</td>
                            <td class="px-4 py-3 text-center">
                                {% if installer.registration_status == 'approved' %}
                                    <span class="inline-block px-3 py-1 text-sm font-semibold text-green-100 bg-green-600 rounded-full">Approved</span>
                                {% elif installer.registration_status == 'submitted' %}
                                    <span class="inline-block px-3 py-1 text-sm font-semibold text-yellow-100 bg-yellow-600 rounded-full">Submitted</span>
                                {% elif installer.registration_status == 'rejected' %}
                                    <span class="inline-block px-3 py-1 text-sm font-semibold text-red-100 bg-red-600 rounded-full">Rejected</span>
                                {% else %}
                                    <span class="inline-block px-3 py-1 text-sm font-semibold text-gray-100 bg-gray-600 rounded-full">Incomplete</span>
                                {% endif %}
                            </td>
                        {% else %}
                            <td colspan="18" class="px-4 py-3 text-center text-red-400">Missing Profile</td>
                        {% endif %}
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="19" class="px-4 py-6 text-center text-gray-300">No installers found.</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}
